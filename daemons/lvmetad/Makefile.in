# Copyright (C) 2011 Red Hat, Inc. All rights reserved.
#
# This file is part of the device-mapper userspace tools.
#
# This copyrighted material is made available to anyone wishing to use,
# modify, copy, or redistribute it subject to the terms and conditions
# of the GNU Lesser General Public License v.2.1.
#
# You should have received a copy of the GNU Lesser General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = @top_builddir@

SOURCES = lvmetad-core.c
SOURCES2 = testclient.c

TARGETS = lvmetad lvmetad-testclient

.PHONY: install_lvmetad

INCLUDES += -I$(top_srcdir)/daemons/common
INSTALL_LVMETAD_TARGETS = install_lvmetad
CLEAN_TARGETS = lvmetad lvmetad-testclient

CFLOW_LIST = $(SOURCES)
CFLOW_LIST_TARGET = $(LIB_NAME).cflow
CFLOW_TARGET = lvmetad

include $(top_builddir)/make.tmpl

device-mapper: $(TARGETS)

LIBS += -ldevmapper -ldaemon $(PTHREAD_LIBS)

lvmetad: lvmetad-core.o
	$(CC) $(CFLAGS) $(LDFLAGS) -L$(top_builddir)/daemons -o $@ lvmetad-core.o \
	$(DL_LIBS) $(LVMLIBS) $(LIBS) -rdynamic

# TODO: No idea. No idea how to test either.
#ifneq ("$(CFLOW_CMD)", "")
#CFLOW_SOURCES = $(addprefix $(srcdir)/, $(SOURCES))
#-include $(top_builddir)/libdm/libdevmapper.cflow
#-include $(top_builddir)/lib/liblvm-internal.cflow
#-include $(top_builddir)/lib/liblvm2cmd.cflow
#-include $(top_builddir)/daemons/dmeventd/$(LIB_NAME).cflow
#-include $(top_builddir)/daemons/dmeventd/plugins/mirror/$(LIB_NAME)-lvm2mirror.cflow
#endif

install_lvmetad: lvmetad
	$(INSTALL_PROGRAM) -D $< $(sbindir)/$(<F)

install: install_lvmetad

install_device-mapper: install_lvmetad
